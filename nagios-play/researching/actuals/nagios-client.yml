---
  - name: this playbook is for configuring nagios client(s)
    hosts: manage.example.com
    remote_user: root
    
    vars:
      nagios_server: 192.168.56.101

    tasks:
    - name: install epel-repo
      yum: name=epel-release state=present
    
    - name: install package nrpe, nagios-plugins-all and openssl
      yum: name={{item}} state=present
      with_items:
        - nrpe
        - nagios-plugins-all
        - openssl

    - name: enter nagios-server IP in nrpe config file
      lineinfile: 
        dest: /etc/nagios/nrpe.cfg
        regexp: allowed_hosts=
        line: allowed_hosts=127.0.0.1,{{nagios_server}} 

    - name: start and enable nrpe service
      service: name=nrpe state=restarted enabled=yes
